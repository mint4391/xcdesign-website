<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
  />
  <title>个人视觉设计 | 周晓城</title>

  <link
    rel="icon"
    href="https://xcdesign-1306237972.cos.ap-guangzhou.myqcloud.com/favicon.png"
  />

  <!-- Fancybox -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css"
  />


  <style>
    
    :root {
      --bg: #20252c;
      --card: #2a3039;
      --accent: #007aff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      /* 移动端点击去高亮 */
      -webkit-tap-highlight-color: transparent; 
    }

    body {
      background: var(--bg);
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }

    /* 首页平铺布局 */
    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 15px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .media-item {
      background: var(--card);
      border-radius: 8px;
      overflow: hidden;
      cursor: zoom-in;
      transition: transform 0.35s ease;
      position: relative; /* 确保遮罩层定位正确 */
    }

    /* Hover 微放大 */
    .media-item:hover {
      transform: scale(1.015);
      box-shadow: #000813ae 0 4px 15px;
      transition: transform 0.25s ease;
    }

    .media-item img,
    .media-item video {
      width: 100%;
      display: block;
    }

    /* 首页视频：像 GIF 一样，不可交互 */
    .media-item video {
      pointer-events: none;
    }

    /* 关键：透明遮罩，防止安卓点击穿透问题 */
    .click-mask {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 5;
      background: transparent;
      cursor: zoom-in;
    }

    .fancybox__content {
      background: transparent !important;
    }

    /* 控件渐隐效果 */
    .fancybox__toolbar,
    .fancybox__infobar,
    .fancybox__thumbs {
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .fancybox__container.is-scaling .fancybox__toolbar,
    .fancybox__container.is-scaling .fancybox__infobar,
    .fancybox__container.is-scaling .fancybox__thumbs,
    .fancybox__container.is-dragging .fancybox__toolbar,
    .fancybox__container.is-dragging .fancybox__infobar,
    .fancybox__container.is-dragging .fancybox__thumbs {
      opacity: 0;
      pointer-events: none;
    }

    /* 缩略图样式优化 */
    .f-thumbs__slide {
      box-sizing: border-box !important;
      width: 60px !important;
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.3s ease;
      position: relative;
      
      /* 默认没有边框和内边距 */
      border: 0 solid transparent; 
      padding: 0;
    }

    .f-thumbs__slide__img {
      width: 100% !important;
      height: 100% !important;
      display: block;
      object-fit: cover !important; 
      border-radius: 0;
      transition: all 0.3s ease;
    }

    /* 添加黑色遮罩 */
    .f-thumbs__slide:not(.is-nav-selected)::before {
      content: "";
      position: absolute;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.25);
      pointer-events: none;
      transition: background-color 0.3s ease;
      z-index: 1;
    }

    /* 悬浮时去除遮罩 */
    .f-thumbs__slide:not(.is-nav-selected):hover::before {
      background-color: transparent;
    }

    /* 选中态样式 */
    .f-thumbs__slide.is-nav-selected {
      width: 100px !important; /* 选中变宽 */
      border: 2px solid #fff !important; /* 设置白色边框 */
      padding: 4px!important; /* 核心：使用 padding 实现 4px 间距 */
      background: transparent;/* 确保背景透明，间距处显示的是底层颜色 */
    }

     /* 选中态下的图片处理 */
    .f-thumbs__slide.is-nav-selected .f-thumbs__slide__img {
      border-radius: 4px; 
    }

    .fancybox__thumbs {
      --f-thumb-width: 100%;
      --f-thumb-height: 60px;
    }

    /* 按钮样式优化：圆形按钮 */
    .fancybox__button {
      border-radius: 50% !important; 
      width: 44px !important;
      height: 44px !important;
      padding: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      background: rgba(34, 34, 34, 0.8) !important;
      color: #fff !important;
      box-shadow: none !important;
    }

    .fancybox__button.fancybox__button--close {
      border-radius: 50% !important;
    }

    .fancybox__button:hover,
    .fancybox__button:focus {
      border-radius: 50% !important;
      background: rgba(34, 34, 34, 1) !important;
    }

    /* GIF-like Video */
    .v-container {
      display: flex;
      justify-content: center;
      align-items: center;
      max-height: 80vh;
      width: 100%;
    }

    .v-container video {
      max-height: 80vh;
      width: auto;
      max-width: 100%;
      object-fit: contain;
      pointer-events: none;
      background: #000;
    }

    .is-compact .fancybox__thumbs {
      --f-thumb-width: 100% important;
    }

    .f-thumbs__slide__button {
      width: 100%;
    }

    /* 彻底移除原生视频控件 & PiP */
    video::-webkit-media-controls,
    video::-webkit-media-controls-panel,
    video::-webkit-media-controls-overlay-play-button {
      display: none !important;
    }

    video {
      outline: none;
    }

    footer {
      padding: 40px 0;
      text-align: center;
      font-size: 12px;
      color: #555;
    }
  </style>
</head>
<body>

<main class="container" id="gallery-root"></main>

<footer>© 周晓城 · All Rights Reserved</footer>

<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>

<script>
  const cos =
    "https://xcdesign-1306237972.cos.ap-guangzhou.myqcloud.com/";
  const root = document.getElementById("gallery-root");

  const videoIds = [18, 21, 23, 31, 35, 40, 42];


  for (let i = 1; i <= 43; i++) {
    const isVideo = videoIds.includes(i);
    const a = document.createElement("a");
    a.className = "media-item";
    a.dataset.fancybox = "gallery";

    if (!isVideo) {
      a.href = `${cos}${i}.png`;
      a.innerHTML = `<img src="${cos}${i}.png" loading="lazy">`;
    } else {

      // --- 视频处理 ---
      // Fancybox 内容 (保留 autoplay)
      a.dataset.type = "html";
      a.dataset.thumb = `${cos}${i - 1}.png`;
      a.dataset.src = `
        <div class="v-container">
          <video
            src="${cos}${i}.mp4"
            autoplay loop muted playsinline
            disablepictureinpicture
            controlslist="nodownload nofullscreen noremoteplayback"
          ></video>
        </div>
      `;

      // 列表预览内容
      a.innerHTML = `
        <div class="click-mask"></div>
        <video
          src="${cos}${i}.mp4"
          loop muted playsinline
          disablepictureinpicture
          poster="${cos}${i - 1}.png"
          preload="metadata"
        ></video>
      `;
      // 标记类名，方便 JS 查找
      a.classList.add('video-wrapper');
    }

    root.appendChild(a);
  }

  // 视频强力播放函数 (修复 Edge/Chrome 首次不播放)
  function forcePlay(video) {
    if (!video) return;
    video.muted = true;
    video.playsInline = true; // iOS 关键
    
    const attempt = () => {
      // 如果已经在播放，可以停止尝试
      if (!video.paused && video.currentTime > 0) return; 
      video.play().catch(e => { /* 忽略未加载完成的报错 */ });
    };

    attempt();
    // 轮询重试：解决浏览器加载延迟导致的播放失败
    let count = 0;
    const interval = setInterval(() => {
      count++;
      if (count > 20 || (!video.paused && video.currentTime > 0)) {
        clearInterval(interval);
      } else {
        attempt();
      }
    }, 50); // 每50ms尝试一次，持续1秒
  }


  // Fancybox 配置 (修复安卓层级遮挡 + 自动播放)

  Fancybox.bind("[data-fancybox='gallery']", {
    backdropColor: "auto",
    Image: { decode: true, lazy: true },
    Images: { zoom: false }, //禁止视频上的双击缩放
    Toolbar: {
      display: {
        left: ["infobar"],
        right: ["thumbs", "fullscreen", "close"]
      }
    },
    Thumbs: { autoStart: true },
    l10n: { COUNT: "{current} / {total}" },

    on: {
      // 打开弹窗准备就绪
      "Carousel.ready": (fancybox) => {
        const slide = fancybox.getSlide();
        const video = slide?.$content?.querySelector("video");
        
        // 触发播放
        forcePlay(video);

        // 修复安卓/小米视频层级遮挡
        // 获取触发弹窗的那个列表元素
        const trigger = slide.triggerEl;
        if (trigger && trigger.classList.contains('video-wrapper')) {
           const listVideo = trigger.querySelector('video');
           if (listVideo) {
             // 强制隐藏列表中的原视频，防止它浮在弹窗上面
             listVideo.style.visibility = 'hidden';
           }
        }
      },
      
      // 切换视频
      "Carousel.change": (fancybox) => {
        const video = fancybox.getSlide()?.$content?.querySelector("video");
        forcePlay(video);
      },

      // 切换动画结束 (移动端最稳妥的播放时机)
      "Carousel.settle": (fancybox) => {
        const video = fancybox.getSlide()?.$content?.querySelector("video");
        forcePlay(video);
      },

      // 关闭弹窗
      "close": () => {
        // 恢复列表视频显示
        document.querySelectorAll('.video-wrapper video').forEach(v => {
          v.style.visibility = 'visible';
        });
      }
    }
  });


  // 列表页滚动播放 (PC/Mobile 通用)
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const video = entry.target.querySelector('video');
      if (!video) return;

      // 如果视频被 Fancybox 隐藏了，就不要播放
      if (video.style.visibility === 'hidden') return;

      if (entry.isIntersecting) {
        video.muted = true;
        video.play().catch(() => {});
      } else {
        video.pause();
      }
    });
  }, { threshold: 0.5 }); // 露出50%播放

  const videoWrappers = document.querySelectorAll('.video-wrapper');
  videoWrappers.forEach(wrapper => observer.observe(wrapper));


  //  基础保护
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
  });

</script>

</body>
</html>